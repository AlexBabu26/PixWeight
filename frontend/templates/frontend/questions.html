{% extends "frontend/base.html" %}
{% load static %}
{% block title %}Questions | PixWeight{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">
    <div class="card fade-in">
      <div class="card-body p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-start gap-3 flex-wrap">
          <div>
            <div class="d-flex align-items-center gap-2 mb-2">
              <div class="d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; background: var(--primary-gradient); border-radius: 10px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
              </div>
              <h1 class="h4 fw-bold mb-0">Answer Questions</h1>
            </div>
            <div class="text-muted" id="objectMeta">
              <svg class="me-1" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
              Loading object details...
            </div>
          </div>
          <a class="btn btn-outline-secondary btn-sm" href="/dashboard/">
            <svg class="me-1" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Estimation
          </a>
        </div>

        <div class="divider"></div>

        <div class="alert alert-danger d-none" id="errorBox"></div>
        <div class="alert alert-info d-none" id="infoBox"></div>

        <!-- Progress indicator -->
        <div class="mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="small fw-semibold text-muted">Step 2 of 3: Answer Questions</span>
            <span class="small text-muted">Almost there!</span>
          </div>
          <div class="progress" style="height: 6px; border-radius: 3px;">
            <div class="progress-bar" role="progressbar" style="width: 66%; background: var(--primary-gradient);" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>

        <form id="questionsForm">
          <div id="questionsContainer">
            <!-- Questions will be dynamically inserted here -->
            <div class="text-center py-4">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              <span class="text-muted">Loading questions...</span>
            </div>
          </div>

          <div class="divider"></div>

          <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
            <a href="/dashboard/" class="btn btn-outline-secondary">
              <svg class="me-1" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Back
            </a>
            
            <div class="d-flex align-items-center gap-3">
              <span class="d-none align-items-center" id="loading">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                <span class="text-muted">Estimating weight...</span>
              </span>
              
              <button class="btn btn-success btn-lg" type="submit" id="btnSubmit">
                <svg class="me-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Get Weight Estimate
              </button>
            </div>
          </div>
        </form>

      </div>
    </div>
    
    <!-- Tips Card -->
    <div class="card mt-4 fade-in" style="animation-delay: 0.1s; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); border-left: 4px solid var(--primary-color);">
      <div class="card-body p-3">
        <div class="d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center flex-shrink-0" style="width: 40px; height: 40px; background: var(--primary-gradient); border-radius: 10px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </div>
          <div>
            <h4 class="h6 fw-bold mb-1">Better answers = Better estimates</h4>
            <p class="small text-muted mb-0">Try to be as accurate as possible with measurements. Use a ruler or measuring tape if available.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'frontend/js/questions.js' %}"></script>
<script>
// Enhanced question rendering
const originalRender = window.renderQuestions;
if (typeof originalRender === 'function') {
  window.renderQuestions = function(questions) {
    const container = document.getElementById('questionsContainer');
    container.innerHTML = questions.map((q, i) => `
      <div class="question-card fade-in" style="animation-delay: ${i * 0.1}s;">
        <div class="d-flex align-items-start gap-3">
          <span class="question-number">${i + 1}</span>
          <div class="flex-grow-1">
            <label class="form-label fw-semibold mb-2">${q.question}</label>
            <input class="form-control form-control-lg" name="q_${i}" placeholder="Enter your answer..." required>
          </div>
        </div>
      </div>
    `).join('');
  };
}
</script>
{% endblock %}
